pico-8 cartridge // http://www.pico-8.com
version 43
__lua__
function _init()
  spr_size=8
  fancyfill_ct=1
  fancyfill={
    0b1010010101011010,
    0b0101010110101010,
    0b0101101010100101,
    0b1010101001010101,
  }

  player={
    health=5,
    stats={str=50,agl=50,lck=00},
    stats_order={"str","agl","lck"},
    get_hearts=function(self)
      if self.health==0 then return {7,7,7,7} end
      if self.health==1 then return {6,7,7,7} end
      if self.health==2 then return {5,7,7,7} end
      if self.health==3 then return {5,6,7,7} end
      if self.health==4 then return {5,5,7,7} end
      if self.health==5 then return {5,5,6,7} end
      if self.health==6 then return {5,5,5,7} end
      if self.health==7 then return {5,5,5,6} end
      if self.health==8 then return {5,5,5,5} end
    end,
  }
  
  -- [m]ap, [s]hop, [e]ncounter
  gamestate={ "m", "s", "e",}

  frame_ct=0
end

--[[
  .-----------------------.
  |32768|16384| 8192| 4096|  xoxo xoxo oxox oxox
  |-----|-----|-----|-----|  xoxo oxox oxox xoxo
  | 2048| 1024| 512 | 256 |  oxox oxox xoxo xoxo 
  |-----|-----|-----|-----|  oxox xoxo xoxo oxox
  | 128 |  64 |  32 |  16 |
  |-----|-----|-----|-----|
  |  8  |  4  |  2  |  1  |
  '-----------------------'
  {0b1010101001010101}
]]

-->8
function _update()
  frame_ct+=1

  -- shift bg fill every 2 frames
  if frame_ct%2==0 then
    fancyfill_ct+=1
  end

  -- slowly increase player hp
  if frame_ct%20==0 then
    player.health = (player.health + 1) % 9
  end
end

-->8
function _draw()
  -- bg draw
  cls(0)                   -- clear screen black
  set_fill("ff")           -- set fancy upward scrolling fill
  rectfill(0,0,128,128,1)  -- draw fill across entire screen
  fillp()                  -- reset to solid fill
	 
  -- sections
  draw_sidebar()

  -- draw_encounter()
  
end

function draw_sidebar()
  -- bg render
  map()

  -- char pic
  -- spr(1,1*spr_size,1.5*spr_size)

  -- health ----------------
  fancy_container(1,10,25,26,3,1,7)
  hearts=player:get_hearts()
  spr(hearts[1], 4,  14)
  spr(hearts[2], 15, 14)
  spr(hearts[3], 4,  24)
  spr(hearts[4], 15, 24)
  
  -- stats -----------------
  draw_stats()

  -- items -----------------
  fancy_container(1,92,25,26,3,1,7)
  
  spr(8, 4, 96)
  spr(8, 15, 96)
  spr(8, 4, 106)
  spr(8, 15, 106)


end

function fancy_container(x,y,w,h,r,f,b)
  --[[
    Draw a fancy UI container to the screen

    Args: 
      x: Starting x position
      y: Starting y position
      w: Width of the container
      h: Height of the container
      r: Border radius
      f: Fill color
      b: Border color
  ]]
  set_fill()                  -- solid fill
  rrectfill(x, y, w, h, r, f) -- fill solid
  set_fill("fr")              -- fancy fill (inv.)
  rrectfill(x, y, w, h, r, f) -- populate rect w fancy fill
  set_fill()                  -- solid fill
  rrect(x, y+1, w, h, r, 1)   -- border drop shadow
  rrect(x, y, w, h, r, b)     -- border
end

function set_fill(t)
  --[[
    Set fill type based on passed type (t)

    Opts:
      nil:  solid fill
      "ff": fancy-fill (upward scrolling)
      "ff": fancy-fill reversed (downward scrolling)
  ]]
  if     t==nil  then fillp()
  elseif t=="ff" then fillp(fancyfill[(fancyfill_ct%4)+1])
  elseif t=="fr" then fillp(fancyfill[((fancyfill_ct*-1)%4)+1])
  else error("Fill type not accounted for") end
end

function draw_stats()
  local base_height,spacing,line_gap=44,15,7
  for i=1,#player.stats_order do
    local k = player.stats_order[i]
    local v = player.stats[k]
    local val = v < 10 and "0"..v or v
    local base_y = base_height + (spacing * (i-1))
    print(k..":"..val, 2, base_y+1, 1)                   -- draw text
    print(k..":"..val, 2, base_y,   7)                   -- draw text drop shadow
    line(2, base_y+line_gap,   24, base_y+line_gap,   7) -- draw underline
    line(2, base_y+line_gap+1, 24, base_y+line_gap+1, 1) -- draw underline shadow
  end
end


__gfx__
000000000000000000000000000000000000000000000000000000000000000000000000e000000e566660000000000000000000000000000000000000000000
00000000000000000000000000000000000000000dd00dd00dd00dd00dd00dd000d55d00ee00008e05dd00000000000000000000000000000000000000000000
0070070000000000000000000000000000000000de7dde7dde7dd55dd51dd15d0d5115d06eeddee60d6666600000000000000000000000000000000000000000
00077000000007aa7a999aa77a99aaaaaa900000e887e887e8875115d111111d0511115066666666d66ccc660000000000000000000000000000000000000000
0007700000007a99999449999449999949aa0000e888888ee8881115d111111d05111150ddd66dddd6c666c60000000000000000000000000000000000000000
007007000007a9111111111111111111194a9000de8888edde88115d0d1111d00d5115d066666666d66ccc660000000000000000000000000000000000000000
000000000004941dddddddddddddddddd114a0000de88ed00de815d000d11d0000d55d00d66ee66d5d66666d0000000000000000000000000000000000000000
000000000009a1ddddddddddddddddddddd1a00000deed0000de5d00000dd000000000000dd22dd005dddd500000000000000000000000000000000000000000
000000000009dddd00000000dddddddddddda0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000009dddd00000000dddddddddddd90000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000009dddd00000000dddddddddddda0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000004dddd00000000dddddddddddda0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000009dddd00000000dddddddddddda0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000009dddd00000000dddddddddddd90000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000009dddd00000000dddddddddddda0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000009dddd00000000dddddddddddda0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000009dddd0000000000000000dddda0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000009dddd0000000000000000dddd90000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000009dddd0000000000000000dddd40000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000adddd0000000000000000dddda0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000009dddd0000000000000000dddda0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000004dddd0000000000000000dddd90000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000009dddd0000000000000000dddd90000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000009dddd0000000000000000dddda0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
e00000020009addddddddddddddddddddddda0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0e000020000497ddddddddddddddddddddda90000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00e0020000049adddddddddddddddddddaa990000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000e2000000049a7aaa77a7aaa7aa7aaa99400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0002e000000009999449999499994999944000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00200e00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
020000e0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
2000000e000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__map__
0302020400000000000000000000000030000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1313132400000000000000000000000030000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1313131400000000000000000000000030000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1313132400000000000000000000000030000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1313132400000000000000000000000030000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1313132400000000000000000000000030000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1313131400000000000000000000000030000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1313132400000000000000000000000030000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1313132400000000000000000000000030000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1313132400000000000000000000000030000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1313132400000000000000000000000030000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1313131400000000000000000000000030000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1313131400000000000000000000000030000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1313132400000000000000000000000030000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1313132400000000000000000000000030000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
3232323400000000000000000000000030000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
3030303030303030303030303030303030000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
